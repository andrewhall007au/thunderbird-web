---
phase: 10-real-trail-data
plan: 05
type: execute
wave: 2
depends_on: ["10-01"]
files_modified:
  - scripts/trail-curation/trail-lists/global-trails.json
  - scripts/trail-curation/results/global-trails-batch1.json
  - scripts/trail-curation/results/global-trails-batch2.json
autonomous: true

must_haves:
  truths:
    - "100 curated global trails cover all remaining weather API countries (JP, NZ, GB, FR, CH, IT, ZA, DE)"
    - "No trail in the global list duplicates a trail in the US, Canada, or Australia lists"
    - "Each trail has 50-200 simplified coordinate points"
    - "Distance validation completed for all trails"
  artifacts:
    - path: "scripts/trail-curation/trail-lists/global-trails.json"
      provides: "Curated list of 100 top global trails covering 8+ countries"
    - path: "scripts/trail-curation/results/global-trails-batch1.json"
      provides: "Fetched trail data for global trails 1-50"
    - path: "scripts/trail-curation/results/global-trails-batch2.json"
      provides: "Fetched trail data for global trails 51-100"
  key_links:
    - from: "scripts/trail-curation/trail-lists/global-trails.json"
      to: "scripts/trail-curation/batch-fetch.ts"
      via: "input file argument"
      pattern: "global-trails.json"
---

<objective>
Curate and fetch real coordinate data for 100 global trails covering all remaining weather API countries, deduplicated against US, Canada, and Australia lists.

Purpose: Expand coverage beyond launch markets to all weather API countries. These trails round out the library with iconic international routes.

Output: Validated trail data JSON files for 100 global trails ready for integration.
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/10-real-trail-data/10-RESEARCH.md

# Pipeline built in Plan 01
@.planning/phases/10-real-trail-data/10-01-SUMMARY.md

# Need to check for duplicates against these
@.planning/phases/10-real-trail-data/10-03-SUMMARY.md
@.planning/phases/10-real-trail-data/10-04-SUMMARY.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Curate global trail list and fetch batch 1 (trails 1-50)</name>
  <files>
    scripts/trail-curation/trail-lists/global-trails.json
    scripts/trail-curation/results/global-trails-batch1.json
  </files>
  <action>
1. Review the US, Canada, and Australia trail lists (from Plans 03/04 results) to know what's already covered. The global list must NOT include any trail already in those lists.

2. Create `scripts/trail-curation/trail-lists/global-trails.json` with 100 TrailInput entries distributed across weather API countries. Aim for roughly equal representation, but prioritize quality/popularity:

   **Existing trails to upgrade (from current popularTrails.ts):**
   - JP (10): Kumano Kodo, Nakasendo, Mt Fuji, Daisetsuzan, Japan Alps Kamikochi, Yakushima, Michinoku Coastal, Mt Yarigatake, Shikoku Pilgrimage, Rebun Island
   - NZ (10): Milford Track, Routeburn Track, Kepler Track, Abel Tasman, Tongariro Northern Circuit, Heaphy Track, Paparoa Track, Hump Ridge Track, Lake Waikaremoana, Rakiura Track
   - GB (10): West Highland Way, Coast to Coast, Pennine Way, Cape Wrath Trail, SW Coast Path, Hadrian's Wall Path, Offa's Dyke, Cambrian Way, Fife Coastal Path, Glyndwr's Way
   - FR (10): Tour du Mont Blanc, GR20, GR10 Pyrenees, GR54 Tour des Ecrins, Haute Route Pyreneenne, Haute Route, Cirque de Gavarnie, Lac Blanc, Mercantour Traverse, Vercors Traverse
   - CH (8): Bernese Oberland, Via Alpina Swiss, Matterhorn Circuit, Five Lakes Walk, Hardergrat Trail, Schynige Platte First, Swiss National Park, Alpstein Circuit
   - IT (9): Alta Via 1, Alta Via 2, Tre Cime di Lavaredo, Cinque Terre, Sentiero degli Dei, Gran Paradiso Traverse, Seceda, Adolf Munkel Trail, Dolomites High Route 8
   - ZA (10): Giants Cup Trail, Otter Trail, Drakensberg Grand Traverse, Amphitheatre Tugela, Cathedral Peak, Mafadi Summit, Fish River Canyon, Rim of Africa, Amatola Trail, Tsitsikamma Trail
   - DE (10): Zugspitze, Westweg, Mittelweg, Schluchtensteig, Jurasteig, Salzalpensteig, Malerweg, Rheinsteig, Eifelsteig, Hochplatte

   That's 77 existing. Add 23 more across these countries:
   - NZ: Mueller Hut Route, Hooker Valley Track, Roy's Peak, Ben Lomond, Rob Roy Glacier
   - JP: Kamikochi to Yarigatake, Mt Tsurugi, Shiratani Unsuikyo (Yakushima forest)
   - GB: Pembrokeshire Coast Path, South Downs Way, Cleveland Way
   - FR: GR34 (Brittany Coast section), Calanques Trail
   - CH: Eiger Trail, Tour du Monte Rosa
   - IT: Path of the Gods extension (Amalfi section), Tour of the Matterhorn (Italian side), Sentiero Roma
   - ZA: Table Mountain Traverse, Whale Trail
   - DE: Albsteig, Rennsteig

   NOTE on Tour du Mont Blanc: it crosses FR/CH/IT. Assign to FR (traditional starting country). Do NOT duplicate in CH or IT lists.

3. Split into batches of 50. Run batch 1:
   ```
   npx tsx scripts/trail-curation/batch-fetch.ts scripts/trail-curation/trail-lists/global-trails-batch1.json scripts/trail-curation/results/global-trails-batch1.json
   ```

4. Review results, retry failures with alternate search terms.
  </action>
  <verify>
Check batch 1 results: at least 40/50 successful. Verify no trail names duplicate those in US/CA/AU lists. Print per-country breakdown.
  </verify>
  <done>
100 global trails curated in trail list. First 50 fetched with at least 80% success rate. No duplicates with US/CA/AU lists.
  </done>
</task>

<task type="auto">
  <name>Task 2: Fetch global trails batch 2 (trails 51-100) and resolve failures</name>
  <files>
    scripts/trail-curation/results/global-trails-batch2.json
  </files>
  <action>
1. Run batch-fetch for trails 51-100:
   ```
   npx tsx scripts/trail-curation/batch-fetch.ts scripts/trail-curation/trail-lists/global-trails-batch2.json scripts/trail-curation/results/global-trails-batch2.json
   ```

2. Review all failures from both batches. For global trails, OSM coverage varies significantly:
   - European trails (FR, CH, IT, DE, GB): Excellent OSM coverage, expect high success
   - Japan: Good coverage for major trails, may need Japanese name search terms (e.g., "熊野古道" for Kumano Kodo)
   - NZ: Good DOC coverage, most Great Walks should be in OSM
   - South Africa: Variable coverage -- some major trails may not be in OSM. Check SANParks for any public trail data.

3. Retry failures:
   - Try native language names as searchName for JP trails
   - Try alternate trail name variations
   - For persistent failures, attempt way-based queries instead of relation-based

4. Target: at least 85/100 successful.

5. Run deduplication check across ALL result files (US, CA, AU, Global):
   ```
   npx tsx scripts/trail-curation/deduplicate-trails.ts scripts/trail-curation/results/
   ```
   (The deduplication script should accept a directory and check across all result files)
   Resolve any cross-list duplicates by removing from the global list.
  </action>
  <verify>
Count total successful global trails across both batches. At least 85/100. Run deduplication across ALL regions -- zero cross-region duplicates. Print per-country success counts.
  </verify>
  <done>
100 global trails fetched. At least 85 have real OSM data. Cross-region deduplication verified -- no trail appears in multiple lists. Per-country breakdown documented.
  </done>
</task>

</tasks>

<verification>
1. global-trails.json contains exactly 100 trail entries covering all 8 non-US/CA/AU weather API countries
2. At least 85% success rate from OSM queries
3. No cross-region duplicates (run deduplicate across all 4 region result files)
4. Each weather API country has at least 5 trails
5. Distance validation completed for all successful trails
</verification>

<success_criteria>
- 100 global trails curated covering JP, NZ, GB, FR, CH, IT, ZA, DE
- At least 85 have real OSM coordinate data
- Zero cross-region duplicates verified
- Each successful trail has 50-200 simplified coordinate points
- All weather API countries represented with meaningful trail counts
</success_criteria>

<output>
After completion, create `.planning/phases/10-real-trail-data/10-05-SUMMARY.md`
</output>
