---
phase: 10-real-trail-data
plan: 05
type: execute
wave: 2
depends_on: ["10-01"]
files_modified:
  - scripts/trail-curation/trail-lists/global-trails.json
  - scripts/trail-curation/results/global-trails-batch1.json
  - scripts/trail-curation/results/global-trails-batch2.json
autonomous: true

must_haves:
  truths:
    - "100 curated global trails cover all remaining weather API countries (JP, GB, FR, CH, IT, ZA, DE)"
    - "No trail in the global list duplicates a trail in the US, Canada, Australia, or New Zealand lists"
    - "Each trail has 50-200 simplified coordinate points"
    - "Distance validation completed for all trails"
    - "Each trail result records its data source for attribution"
  artifacts:
    - path: "scripts/trail-curation/trail-lists/global-trails.json"
      provides: "Curated list of 100 top global trails covering 7 countries (JP, GB, FR, CH, IT, ZA, DE)"
    - path: "scripts/trail-curation/results/global-trails-batch1.json"
      provides: "Fetched trail data for global trails 1-50 with source attribution"
    - path: "scripts/trail-curation/results/global-trails-batch2.json"
      provides: "Fetched trail data for global trails 51-100 with source attribution"
  key_links:
    - from: "scripts/trail-curation/trail-lists/global-trails.json"
      to: "scripts/trail-curation/batch-fetch.ts"
      via: "input file argument"
      pattern: "global-trails.json"
---

<objective>
Curate and fetch real coordinate data for 100 global trails covering all remaining weather API countries (JP, GB, FR, CH, IT, ZA, DE), deduplicated against US, Canada, Australia, and New Zealand lists, with automatic fallback to country-specific government data sources.

Purpose: Expand coverage beyond launch markets to all weather API countries. The fallback chain provides country-specific government sources: Natural England for UK national trails, IGN BD TOPO for French sentiers, SwissTopo Wanderwege for Swiss hiking trails, OpenData Trentino for Italian Dolomites trails, BKG Wanderwege for German trails, and others. European countries should achieve very high success rates due to excellent OSM coverage plus strong government open data.

Output: Validated trail data JSON files for 100 global trails with source attribution, ready for integration.
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/10-real-trail-data/10-RESEARCH.md

# Pipeline built in Plan 01 (includes fallback-sources.ts with per-country endpoints)
@.planning/phases/10-real-trail-data/10-01-SUMMARY.md

# Need to check for duplicates against these
@.planning/phases/10-real-trail-data/10-03-SUMMARY.md
@.planning/phases/10-real-trail-data/10-04-SUMMARY.md
@.planning/phases/10-real-trail-data/10-04b-SUMMARY.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Curate global trail list and fetch batch 1 (trails 1-50)</name>
  <files>
    scripts/trail-curation/trail-lists/global-trails.json
    scripts/trail-curation/results/global-trails-batch1.json
  </files>
  <action>
1. Review the US, Canada, Australia, and New Zealand trail lists (from Plans 03/04/04b results) to know what's already covered. The global list must NOT include any trail already in those lists. In particular, NZ trails are now handled entirely by Plan 10-04b -- do NOT include any NZ trails here.

2. Create `scripts/trail-curation/trail-lists/global-trails.json` with 100 TrailInput entries distributed across 7 weather API countries (JP, GB, FR, CH, IT, ZA, DE). With NZ removed, the former ~15 NZ slots are redistributed to strengthen other countries. Aim for roughly 14-15 trails per country:

   **Japan (15 trails):**
   *Existing 10:*
   1. Kumano Kodo (Kii Peninsula)
   2. Nakasendo Trail (Honshu)
   3. Mt Fuji (Yoshida Trail) (Honshu)
   4. Daisetsuzan Grand Traverse (Hokkaido)
   5. Japan Alps Kamikochi (Honshu)
   6. Yakushima Forest Trail (Kyushu)
   7. Michinoku Coastal Trail (Tohoku)
   8. Mt Yarigatake (Honshu)
   9. Shikoku Pilgrimage (88 Temple Trail) (Shikoku)
   10. Rebun Island Trail (Hokkaido)
   *New 5:*
   11. Kamikochi to Yarigatake Traverse (Honshu)
   12. Mt Tsurugi (Shikoku)
   13. Shiratani Unsuikyo (Yakushima Forest) (Kyushu)
   14. Mt Kita-dake (South Alps) (Honshu)
   15. Tateyama-Kurobe Alpine Route Trek (Honshu)

   **Great Britain (14 trails):**
   *Existing 10:*
   16. West Highland Way (Scotland)
   17. Coast to Coast Walk (England)
   18. Pennine Way (England)
   19. Cape Wrath Trail (Scotland)
   20. South West Coast Path (England)
   21. Hadrian's Wall Path (England)
   22. Offa's Dyke Path (Wales)
   23. Cambrian Way (Wales)
   24. Fife Coastal Path (Scotland)
   25. Glyndwr's Way (Wales)
   *New 4:*
   26. Pembrokeshire Coast Path (Wales)
   27. South Downs Way (England)
   28. Cleveland Way (England)
   29. Great Glen Way (Scotland)

   **France (14 trails):**
   *Existing 10:*
   30. Tour du Mont Blanc (FR/CH/IT -- assigned to FR)
   31. GR20 (Corsica)
   32. GR10 (Pyrenees Traverse)
   33. GR54 Tour des Ecrins (Alps)
   34. Haute Route Pyreneenne (Pyrenees)
   35. Haute Route (Chamonix-Zermatt -- assigned to FR)
   36. Cirque de Gavarnie (Pyrenees)
   37. Lac Blanc (Chamonix)
   38. Mercantour Traverse (Alps)
   39. Vercors Traverse (Alps)
   *New 4:*
   40. GR34 (Brittany Coast section)
   41. Calanques Trail (Provence)
   42. GR5 (Vosges to Nice section)
   43. Tour du Queyras (GR58)

   **Switzerland (14 trails):**
   *Existing 8:*
   44. Bernese Oberland Trek
   45. Via Alpina Swiss
   46. Matterhorn Circuit (Zermatt)
   47. Five Lakes Walk (Pizol)
   48. Hardergrat Trail (Interlaken)
   49. Schynige Platte to First (Bernese Oberland)
   50. Swiss National Park Trails (Engadine)
   51. Alpstein Circuit (Appenzell)
   *New 6:*
   52. Eiger Trail (Grindelwald)
   53. Tour du Monte Rosa
   54. Haute Route (Swiss section -- Verbier to Zermatt)
   55. Aletsch Glacier Panorama Trail
   56. Four Headwaters Trail (Vier-Quellen-Weg)
   57. Jungfrau Eiger Walk

   **Italy (14 trails):**
   *Existing 9:*
   58. Alta Via 1 (Dolomites)
   59. Alta Via 2 (Dolomites)
   60. Tre Cime di Lavaredo Circuit (Dolomites)
   61. Cinque Terre (Sentiero Azzurro) (Liguria)
   62. Sentiero degli Dei (Amalfi Coast)
   63. Gran Paradiso Traverse (Aosta Valley)
   64. Seceda Ridgeline (Dolomites)
   65. Adolf Munkel Trail (Dolomites)
   66. Dolomites High Route 8
   *New 5:*
   67. Path of the Gods extension (Amalfi full section)
   68. Tour of the Matterhorn (Italian side -- Cervinia)
   69. Sentiero Roma (Lombardy Alps)
   70. Selvaggio Blu (Sardinia)
   71. Tour of Monte Bianco (Italian Val Ferret section)

   **South Africa (15 trails):**
   *Existing 10:*
   72. Giants Cup Trail (Drakensberg)
   73. Otter Trail (Garden Route)
   74. Drakensberg Grand Traverse (KwaZulu-Natal)
   75. Amphitheatre / Tugela Falls (Drakensberg)
   76. Cathedral Peak (Drakensberg)
   77. Mafadi Summit (Drakensberg)
   78. Fish River Canyon Trail (Namibia border -- assigned ZA)
   79. Rim of Africa (Western Cape)
   80. Amatola Trail (Eastern Cape)
   81. Tsitsikamma Trail (Garden Route)
   *New 5:*
   82. Table Mountain Traverse (Western Cape)
   83. Whale Trail (De Hoop, Western Cape)
   84. Wild Coast Hiking Trail (Eastern Cape)
   85. Leopard Trail (Tsitsikamma)
   86. Sentinel Peak Hike (Drakensberg)

   **Germany (14 trails):**
   *Existing 10:*
   87. Zugspitze (Bavaria)
   88. Westweg (Black Forest)
   89. Mittelweg (Black Forest)
   90. Schluchtensteig (Black Forest)
   91. Jurasteig (Bavaria)
   92. Salzalpensteig (Bavaria)
   93. Malerweg (Saxon Switzerland)
   94. Rheinsteig (Rhine Valley)
   95. Eifelsteig (Eifel)
   96. Hochplatte (Bavaria)
   *New 4:*
   97. Albsteig (Swabian Alb)
   98. Rennsteig (Thuringian Forest)
   99. Goldsteig (Bavaria/Bohemia)
   100. Heidschnuckenweg (Luneburg Heath)

   NOTE on Tour du Mont Blanc: it crosses FR/CH/IT. Assigned to FR (traditional starting country). Do NOT duplicate in CH or IT lists.
   NOTE on Haute Route: Chamonix-Zermatt crosses FR/CH. Assigned to FR. Swiss section listed separately as a distinct segment.

3. Split into batches of 50. Run batch 1:
   ```
   npx tsx scripts/trail-curation/batch-fetch.ts scripts/trail-curation/trail-lists/global-trails-batch1.json scripts/trail-curation/results/global-trails-batch1.json
   ```

4. The fallback chain handles failures per country:
   - **GB trails** that fail OSM -> Natural England National Trails ArcGIS service (covers the 16 official National Trails) -> OS OpenData (requires free OS_API_KEY env var)
   - **FR trails** that fail OSM -> IGN BD TOPO WFS (data.geopf.fr) -- free since 2021 open data policy
   - **CH trails** that fail OSM -> SwissTopo Wanderwege (data.geo.admin.ch STAC API)
   - **IT trails** that fail OSM -> OpenData Trentino sentieri (covers Dolomites trails)
   - **DE trails** that fail OSM -> BKG DLM250 Wanderwege WFS (sgx.geodatenzentrum.de)
   - **JP trails** that fail OSM -> GSI topo data (limited trail-specific data, mostly backup)
   - **ZA trails** that fail OSM -> SANParks GIS portal (limited coverage, expect some manual for ZA)

   European countries (GB, FR, CH, IT, DE) have excellent OSM coverage AND strong government sources. Expect 95%+ success. Japan has strong OSM mapper community. South Africa will likely have the lowest success rate -- expect a few ZA trails to need manual intervention.

5. Review results, retry failures with alternate search terms.
  </action>
  <verify>
Check batch 1 results: at least 45/50 successful (OSM + fallback combined). Verify NO New Zealand trails are present. Verify no trail names duplicate those in US/CA/AU/NZ lists. Print per-country source breakdown.
  </verify>
  <done>
100 global trails curated in trail list covering 7 countries (JP, GB, FR, CH, IT, ZA, DE). First 50 fetched with automatic fallback chain. Source attribution recorded. No NZ trails. No duplicates with US/CA/AU/NZ lists.
  </done>
</task>

<task type="auto">
  <name>Task 2: Fetch global trails batch 2 (trails 51-100) and resolve failures</name>
  <files>
    scripts/trail-curation/results/global-trails-batch2.json
  </files>
  <action>
1. Run batch-fetch for trails 51-100:
   ```
   npx tsx scripts/trail-curation/batch-fetch.ts scripts/trail-curation/trail-lists/global-trails-batch2.json scripts/trail-curation/results/global-trails-batch2.json
   ```

2. The fallback chain handles most failures automatically. Review the batch summary for per-country source breakdown. Expected pattern:
   - European trails (FR, CH, IT, DE, GB): Very high success via OSM alone (~95%), fallback catches the rest
   - Japan: Good OSM coverage for major trails. For JP trails that fail, may need Japanese name search terms (e.g., "熊野古道" for Kumano Kodo). GSI fallback has limited trail data -- JP failures after OSM are likely manual cases.
   - South Africa: Most variable coverage. SANParks GIS portal has limited trail-specific data. Drakensberg trails are well-mapped in OSM but some Western Cape/Eastern Cape trails may need manual intervention.

3. For trails that fail ALL sources from both batches:
   - Try native language names as searchName for JP trails
   - Try alternate trail name variations for all countries
   - For persistent failures, attempt way-based queries instead of relation-based
   - These should be a small number (likely <5 total across all 100 trails)

4. Target: at least 93/100 successful (OSM + fallback combined), up from previous 85 OSM-only target.

5. Run deduplication check across ALL result files (US, CA, AU, NZ, Global) using directory scanning:
   ```
   npx tsx scripts/trail-curation/deduplicate-trails.ts scripts/trail-curation/results/
   ```
   This scans all JSON files in the results directory and checks for cross-region duplicates.
   Resolve any cross-list duplicates by removing from the global list.
   IMPORTANT: Verify zero NZ trails appear in the global results.

6. Print final source attribution summary:
   ```
   === GLOBAL TRAILS FINAL SUMMARY ===
   Total: 100
   Via OSM: ~80
   Via Natural England: ~3
   Via IGN BD TOPO: ~2
   Via SwissTopo: ~2
   Via OpenData Trentino: ~2
   Via BKG: ~1
   Via SANParks: ~1
   Via GSI: ~0
   Manual needed: ~5 (mostly ZA and JP)
   ```
  </action>
  <verify>
Count total successful global trails across both batches. At least 93/100 (up from 85). Run deduplication across ALL regions (including NZ) -- zero cross-region duplicates. Zero NZ trails present. Print per-country source attribution breakdown.
  </verify>
  <done>
100 global trails fetched across 7 countries (JP, GB, FR, CH, IT, ZA, DE). At least 93 have real data from OSM or country-specific government fallback sources. Source attribution recorded for each trail. Cross-region deduplication verified. Only trails that exhausted ALL sources are flagged for manual intervention.
  </done>
</task>

</tasks>

<verification>
1. global-trails.json contains exactly 100 trail entries covering 7 countries (JP, GB, FR, CH, IT, ZA, DE)
2. Zero NZ trails in the global list
3. At least 93% success rate combining OSM + fallback sources (up from 85% OSM-only)
4. Each trail result includes `dataSource` field
5. No cross-region duplicates (run deduplicate across all 5 region result files including NZ)
6. Each weather API country has at least 10 trails
7. Distance validation completed for all successful trails
</verification>

<success_criteria>
- 100 global trails curated covering JP, GB, FR, CH, IT, ZA, DE (NOT NZ)
- At least 93 have real coordinate data (OSM + country-specific government fallback)
- Zero cross-region duplicates verified (including against NZ list)
- Each successful trail has 50-200 simplified coordinate points
- Each trail records its data source for attribution
- All 7 weather API countries represented with at least 10 trails each
- Only trails that exhausted ALL sources are flagged for manual intervention
</success_criteria>

<output>
After completion, create `.planning/phases/10-real-trail-data/10-05-SUMMARY.md`
</output>
