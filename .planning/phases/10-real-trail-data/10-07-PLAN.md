---
phase: 10-real-trail-data
plan: 07
type: execute
wave: 4
depends_on: ["10-06"]
files_modified:
  - scripts/trail-curation/distance-report.ts
autonomous: false

must_haves:
  truths:
    - "Distance validation report generated for all 250+ trails"
    - "No trail is >2% shorter than its official distance without being flagged and reviewed"
    - "User has visually spot-checked trail overlay accuracy for flagged trails"
    - "OSM attribution is present somewhere accessible"
  artifacts:
    - path: "scripts/trail-curation/distance-report.ts"
      provides: "Generates distance validation report for all trails in popularTrails.ts"
  key_links:
    - from: "scripts/trail-curation/distance-report.ts"
      to: "app/data/popularTrails.ts"
      via: "import popularTrails"
      pattern: "import.*popularTrails"
---

<objective>
Run final accuracy validation on all trail data, generate distance report, and get user sign-off on trail quality via visual spot-checking.

Purpose: This is the quality gate ensuring we don't ship inaccurate trail data. Distance validation catches systematically bad data. Visual spot-checking catches subtle issues like trails that follow roads instead of the hiking path.

Output: Validation report and user approval of trail data quality.
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md

# Integration complete
@.planning/phases/10-real-trail-data/10-06-SUMMARY.md

# Current trail data
@app/data/popularTrails.ts (first 15 lines)
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create and run distance validation report across all trails</name>
  <files>
    scripts/trail-curation/distance-report.ts
  </files>
  <action>
1. Create `scripts/trail-curation/distance-report.ts`:
   - Import popularTrails from the app data file (use relative path to `../../app/data/popularTrails`)
   - For each trail, calculate total haversine distance from its coordinates
   - Compare against distance_km field (which is the official distance)
   - Flag any trail where calculated distance is >2% shorter than official OR >20% longer (likely bad data)
   - Generate a markdown report table:
     ```
     | Country | Trail | Official (km) | Calculated (km) | Diff (%) | Status |
     ```
   - Status: PASS (within 2%), FLAG (>2% short), WARN (>20% long), SKIP (no official distance)
   - Write report to `scripts/trail-curation/VALIDATION-REPORT.md`
   - Print summary: X passed, Y flagged, Z warned

2. Run the validation:
   ```
   npx tsx scripts/trail-curation/distance-report.ts
   ```

3. Review flagged trails:
   - For trails flagged as "too short": the OSM data likely has gaps or shortcuts. Check if the simplified coordinates lost too much detail. If the raw OSM data was fine but simplification was too aggressive, re-fetch with higher target points (150-200).
   - For trails flagged as "too long": likely includes side trails or alternate routes. Check if we grabbed the wrong OSM relation.
   - Fix what can be fixed automatically. For trails that need manual intervention, document in the report.

4. Re-run validation after fixes until fewer than 10% of trails are flagged.

5. Ensure OSM attribution: Add a comment at the top of popularTrails.ts:
   ```
   // Trail coordinate data sourced from OpenStreetMap (openstreetmap.org)
   // Data (c) OpenStreetMap contributors, licensed under ODbL
   // Coordinates simplified for use as visual planning aids only
   ```
  </action>
  <verify>
VALIDATION-REPORT.md exists with entries for all 250+ trails. Fewer than 10% flagged. OSM attribution comment in popularTrails.ts.
  </verify>
  <done>
Distance validation complete for all trails. Fewer than 10% flagged (and those are documented with reasons). OSM attribution added.
  </done>
</task>

<task type="checkpoint:human-verify" gate="blocking">
  <what-built>
Complete trail data replacement: 250+ trails with real OSM coordinate data, grouped by country in the UI, with distance validation report.
  </what-built>
  <how-to-verify>
1. Run `npm run dev` and navigate to the route builder page
2. Open the trail selector -- verify trails are grouped by country with headers
3. Verify all 11 weather API countries appear (AU, CA, FR, DE, IT, JP, NZ, ZA, CH, GB, US)
4. Count approximate trails per major country: US should have ~100, AU ~50, CA ~25
5. Select a few trails you know well and verify the route looks correct on the map:
   - Pacific Crest Trail (should run CA->OR->WA along the mountain spine)
   - Tour du Mont Blanc (should loop around Mont Blanc through FR/IT/CH)
   - Overland Track Tasmania (should run through Cradle Mountain region)
   - West Highland Way (should run from Glasgow area to Fort William)
6. Search for "Tasmania" -- should show ~25 Tasmanian trails
7. Search for "Alps" -- should show trails across multiple countries
8. Review the validation report at `scripts/trail-curation/VALIDATION-REPORT.md` -- any flagged trails that concern you?
9. Check that the overall user experience is smooth -- no lag loading 250+ trails, search is responsive
  </how-to-verify>
  <resume-signal>Type "approved" to complete Phase 10, or describe any trails that need fixing</resume-signal>
</task>

</tasks>

<verification>
1. VALIDATION-REPORT.md shows <10% flagged trails
2. User approves trail data quality after visual inspection
3. `npm run build` passes
4. All 11 countries visible in TrailSelector
5. Search works across the full 250+ trail library
</verification>

<success_criteria>
- Distance validation report generated with <10% flagged trails
- User visually spot-checked key trails and approved accuracy
- OSM attribution present in popularTrails.ts
- Full build passes
- TrailSelector performance acceptable with 250+ trails
</success_criteria>

<output>
After completion, create `.planning/phases/10-real-trail-data/10-07-SUMMARY.md`
</output>
