---
phase: 10-real-trail-data
plan: 03
type: execute
wave: 2
depends_on: ["10-01"]
files_modified:
  - scripts/trail-curation/trail-lists/us-trails.json
  - scripts/trail-curation/results/us-trails-batch1.json
  - scripts/trail-curation/results/us-trails-batch2.json
autonomous: true

must_haves:
  truths:
    - "100 curated US trails have real coordinate data from OSM or fallback government sources"
    - "Each trail has 50-200 simplified coordinate points"
    - "Distance validation passes for all 100 trails (within 2% of official or flagged and fixed)"
    - "Each trail result records its data source (OSM, USFS, NPS, BLM, or manual)"
  artifacts:
    - path: "scripts/trail-curation/trail-lists/us-trails.json"
      provides: "Curated list of 100 top US hiking trails with metadata"
      contains: "officialDistanceKm"
    - path: "scripts/trail-curation/results/us-trails-batch1.json"
      provides: "Fetched and validated trail data for US trails 1-50"
    - path: "scripts/trail-curation/results/us-trails-batch2.json"
      provides: "Fetched and validated trail data for US trails 51-100"
  key_links:
    - from: "scripts/trail-curation/trail-lists/us-trails.json"
      to: "scripts/trail-curation/batch-fetch.ts"
      via: "input file argument"
      pattern: "us-trails.json"
---

<objective>
Curate and fetch real coordinate data for the top 100 US hiking trails using the trail curation pipeline with automatic fallback to USFS/NPS/BLM data sources.

Purpose: US is the primary launch market. These 100 trails replace the current 10 simplified US trails with GPX-quality coordinate data from OpenStreetMap, with automatic fallback to USFS (National Forest System Trails), NPS, and BLM open data when OSM validation fails.

Output: Validated trail data JSON files containing 100 US trails with real coordinates and source attribution, ready for integration into popularTrails.ts.
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/10-real-trail-data/10-RESEARCH.md

# Pipeline built in Plan 01 (includes fallback-sources.ts)
@.planning/phases/10-real-trail-data/10-01-SUMMARY.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create curated US trail list and fetch batch 1 (trails 1-50)</name>
  <files>
    scripts/trail-curation/trail-lists/us-trails.json
    scripts/trail-curation/results/us-trails-batch1.json
  </files>
  <action>
1. Create `scripts/trail-curation/trail-lists/us-trails.json` containing exactly 100 TrailInput entries. The complete curated list of 100 US trails is below. For each trail, provide: name, searchName (OSM name if different from display name), region (state abbreviation), country ("US"), officialDistanceKm (research from Wikipedia/NPS/USFS -- public facts), typicalDays, bbox ([minLng, minLat, maxLng, maxLat] covering the trail area).

**THE COMPLETE 100 US TRAILS LIST:**

*Existing 10 (keep, upgrade coordinates):*
1. Pacific Crest Trail (CA/OR/WA)
2. Appalachian Trail (GA to ME)
3. John Muir Trail (CA)
4. Continental Divide Trail (MT/ID/WY/CO/NM)
5. Grand Canyon Rim-to-Rim (AZ)
6. Wonderland Trail (WA)
7. Teton Crest Trail (WY)
8. The Enchantments (WA)
9. Four Pass Loop (CO)
10. Isle Royale (Greenstone Ridge Trail) (MI)

*Long-distance iconic (11-20):*
11. Tahoe Rim Trail (CA/NV)
12. Colorado Trail (CO)
13. Long Trail (VT)
14. Superior Hiking Trail (MN)
15. Arizona Trail (AZ)
16. Ozark Highlands Trail (AR)
17. Ice Age Trail (WI)
18. Finger Lakes Trail (NY)
19. Ouachita Trail (AR/OK)
20. Bartram Trail (NC/GA)

*National Park classics -- Yosemite (21-25):*
21. Half Dome Trail (CA)
22. Clouds Rest Trail (CA)
23. Cathedral Lakes Trail (CA)
24. Mist Trail to Nevada Fall (CA)
25. Yosemite Grand Traverse (CA)

*National Park classics -- Zion & Bryce (26-30):*
26. Angels Landing (UT)
27. The Narrows (UT)
28. West Rim Trail (Zion) (UT)
29. Observation Point Trail (UT)
30. Navajo Loop / Queens Garden (Bryce Canyon) (UT)

*National Park classics -- Glacier (31-35):*
31. Highline Trail (Glacier) (MT)
32. Grinnell Glacier Trail (MT)
33. Hidden Lake Trail (MT)
34. Dawson Pass to Pitamakan Pass Loop (MT)
35. Iceberg Lake Trail (MT)

*National Park classics -- Grand Canyon (36-38):*
36. Bright Angel Trail (AZ)
37. South Kaibab Trail (AZ)
38. North Kaibab Trail (AZ)

*National Park classics -- Rocky Mountain (39-43):*
39. Longs Peak (CO)
40. Emerald Lake Trail (CO)
41. Sky Pond Trail (CO)
42. Flattop Mountain to Hallett Peak (CO)
43. Bear Lake to Fern Lake (CO)

*National Park classics -- Other parks (44-50):*
44. Mt Whitney (CA)
45. Kalalau Trail (HI)
46. Hoh River Trail (WA)
47. Skyline Trail (Mt Rainier) (WA)
48. Cascade Pass to Sahale Arm (WA)
49. Paintbrush Canyon / Cascade Canyon Loop (WY)
50. Lake Solitude Trail (WY)

*Western wilderness (51-65):*
51. Wind River High Route (WY)
52. Rae Lakes Loop (CA)
53. Trans-Catalina Trail (CA)
54. Lost Coast Trail (CA)
55. Trinity Alps Traverse (CA)
56. Rogue River Trail (OR)
57. Three Sisters Loop (OR)
58. Timberline Trail (Mt Hood) (OR)
59. Eagle Creek Trail (OR)
60. Sawtooth Traverse (ID)
61. Bob Marshall Traverse (MT)
62. Uinta Highline Trail (UT)
63. Zion Traverse (UT)
64. Capitol Reef (Waterpocket Fold) (UT)
65. Coyote Gulch (UT)

*Appalachian / Eastern (66-80):*
66. Franconia Ridge Traverse (NH)
67. Presidential Traverse (NH)
68. Pemi Loop (NH)
69. Great Smoky Mountains (AT section, Clingmans Dome) (TN/NC)
70. Knife Edge Trail (Katahdin) (ME)
71. Crawford Path (NH)
72. Cranberry Wilderness Loop (WV)
73. Dolly Sods Wilderness Loop (WV)
74. Linville Gorge Trail (NC)
75. Old Rag Circuit (VA)
76. Roan Highlands (AT section) (TN/NC)
77. Grafton Loop Trail (ME)
78. Mahoosuc Notch (AT section) (ME/NH)
79. Art Loeb Trail (NC)
80. Foothills Trail (SC/NC)

*Southwest / Desert (81-90):*
81. Havasupai Falls Trail (AZ)
82. Superstition Ridgeline Trail (AZ)
83. Grand Gulch (UT)
84. Escalante Route (Grand Canyon) (AZ)
85. Buckskin Gulch (UT/AZ)
86. The Wave approach (Coyote Buttes) (AZ)
87. Paria Canyon (UT/AZ)
88. Guadalupe Peak Trail (TX)
89. Chisos Basin Loop (Big Bend) (TX)
90. Dark Canyon (UT)

*Pacific Northwest / Alaska (91-96):*
91. Spray Park Trail (WA)
92. Goat Rocks Loop (WA)
93. Enchanted Valley Trail (WA)
94. Chilkoot Trail (AK)
95. Resurrection Pass Trail (AK)
96. Kesugi Ridge Trail (AK)

*Mountain West / Other (97-100):*
97. Highline Trail (Uintas) (UT)
98. Teton Loop via Alaska Basin (WY)
99. Glacier Peak Wilderness Loop (WA)
100. Beartooth Traverse (MT)

2. Split the 100-trail JSON into two files of 50 each: `us-trails-batch1.json` (trails 1-50) and `us-trails-batch2.json` (trails 51-100). Run batch-fetch for the first 50:
   ```
   npx tsx scripts/trail-curation/batch-fetch.ts scripts/trail-curation/trail-lists/us-trails-batch1.json scripts/trail-curation/results/us-trails-batch1.json
   ```

3. The batch-fetch pipeline now automatically handles fallback. When a trail fails OSM validation, it will automatically try USFS, NPS, and BLM sources in order (from fallback-sources.ts). Review the batch summary output to see the breakdown of OSM vs fallback successes.

4. For trails that still fail after all fallbacks (listed in `failed-trails-{timestamp}.json`):
   - Try alternate search names (e.g., "Half Dome Trail" vs "Half Dome" vs "Yosemite Half Dome")
   - Try broader bounding boxes
   - Retry individually with: `npx tsx -e "import {fetchTrail} from './scripts/trail-curation/fetch-trail'; fetchTrail({name: 'Trail Name', ...}).then(r => console.log(JSON.stringify(r, null, 2)))"`
   - These are genuine hard cases where neither OSM nor government sources have the data -- note them for manual coordinate entry in the integration plan
  </action>
  <verify>
Check results file: it should contain ~50 trail objects. Print the batch summary showing OSM vs fallback breakdown. Count: at least 45/50 should succeed (combining OSM + fallback sources). Only trails that failed ALL sources should remain in the failed list.
  </verify>
  <done>
US trail list of 100 trails is curated with metadata. First batch of 50 trails fetched with automatic fallback chain (OSM -> USFS -> NPS -> BLM). Success rate documented with source attribution. Only trails that exhausted all sources are flagged for manual intervention.
  </done>
</task>

<task type="auto">
  <name>Task 2: Fetch US trails batch 2 (trails 51-100) and resolve remaining failures</name>
  <files>
    scripts/trail-curation/results/us-trails-batch2.json
  </files>
  <action>
1. Run batch-fetch for trails 51-100:
   ```
   npx tsx scripts/trail-curation/batch-fetch.ts scripts/trail-curation/trail-lists/us-trails-batch2.json scripts/trail-curation/results/us-trails-batch2.json
   ```

2. The fallback chain handles most failures automatically. Review the batch summary to see the source breakdown (OSM vs USFS vs NPS vs BLM).

3. For trails that failed ALL sources from both batches, attempt manual resolution:
   - Try different search terms or OSM relation IDs
   - For short trails or well-known peaks that may not be hiking "routes" in OSM (e.g., summit approaches), try querying for `way[highway=path]["name"~"..."]` instead of route relations
   - These should be a small number (likely <5 trails) since the fallback chain handles most OSM failures

4. Target: at least 95 of 100 US trails should have data after OSM + fallback sources. The remaining ~5 are genuinely obscure routes that may need manual coordinate entry in the integration plan.

5. Merge successful results from both batches and retries into final result files.

6. Print final source attribution summary:
   ```
   === US TRAILS FINAL SUMMARY ===
   Total: 100
   Via OSM: ~85
   Via USFS: ~8
   Via NPS: ~4
   Via BLM: ~1
   Manual needed: ~2
   ```
  </action>
  <verify>
Count total successful US trails across both batch results. Should be >= 95/100 (up from previous 85 target, since fallback sources cover the gap). Print list of any remaining failures with reasons -- these should be genuine hard cases where no automated source has the data.
  </verify>
  <done>
100 US trails attempted. At least 95 have real coordinate data from OSM or government fallback sources. Each trail records its data source for attribution. Remaining failures (likely <5) documented with reasons and marked for manual coordinate entry.
  </done>
</task>

</tasks>

<verification>
1. `scripts/trail-curation/trail-lists/us-trails.json` contains exactly 100 trail entries
2. Result files contain trail objects with 50-200 coordinate points each
3. At least 95% success rate combining OSM + fallback sources (up from 85% OSM-only)
4. Each trail result includes `dataSource` field showing which source provided the data
5. Failed trails have documented reasons -- these are post-fallback genuine hard cases
6. No duplicate trails in the list
</verification>

<success_criteria>
- 100 curated US trail definitions exist in trail-lists/us-trails.json
- At least 95 trails have real coordinate data (OSM + USFS/NPS/BLM fallback)
- Each successful trail has 50-200 simplified coordinate points
- Each trail records its data source (dataSource field)
- Distance validation run on all successful trails
- Only trails that exhausted ALL sources (OSM + 3 government fallbacks) are flagged as failures
</success_criteria>

<output>
After completion, create `.planning/phases/10-real-trail-data/10-03-SUMMARY.md`
</output>
