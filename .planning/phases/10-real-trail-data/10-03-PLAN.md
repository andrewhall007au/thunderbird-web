---
phase: 10-real-trail-data
plan: 03
type: execute
wave: 2
depends_on: ["10-01"]
files_modified:
  - scripts/trail-curation/trail-lists/us-trails.json
  - scripts/trail-curation/results/us-trails-batch1.json
  - scripts/trail-curation/results/us-trails-batch2.json
autonomous: true

must_haves:
  truths:
    - "100 curated US trails have real coordinate data from OSM or public sources"
    - "Each trail has 50-200 simplified coordinate points"
    - "Distance validation passes for all 100 trails (within 2% of official or flagged and fixed)"
  artifacts:
    - path: "scripts/trail-curation/trail-lists/us-trails.json"
      provides: "Curated list of 100 top US hiking trails with metadata"
      contains: "officialDistanceKm"
    - path: "scripts/trail-curation/results/us-trails-batch1.json"
      provides: "Fetched and validated trail data for US trails 1-50"
    - path: "scripts/trail-curation/results/us-trails-batch2.json"
      provides: "Fetched and validated trail data for US trails 51-100"
  key_links:
    - from: "scripts/trail-curation/trail-lists/us-trails.json"
      to: "scripts/trail-curation/batch-fetch.ts"
      via: "input file argument"
      pattern: "us-trails.json"
---

<objective>
Curate and fetch real coordinate data for the top 100 US hiking trails using the trail curation pipeline.

Purpose: US is the primary launch market. These 100 trails replace the current 10 simplified US trails with GPX-quality coordinate data from OpenStreetMap.

Output: Validated trail data JSON files containing 100 US trails with real coordinates, ready for integration into popularTrails.ts.
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/10-real-trail-data/10-RESEARCH.md

# Pipeline built in Plan 01
@.planning/phases/10-real-trail-data/10-01-SUMMARY.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create curated US trail list and fetch batch 1 (trails 1-50)</name>
  <files>
    scripts/trail-curation/trail-lists/us-trails.json
    scripts/trail-curation/results/us-trails-batch1.json
  </files>
  <action>
1. Create `scripts/trail-curation/trail-lists/us-trails.json` containing 100 TrailInput entries for the top US hiking trails. This is a CURATED list -- select trails based on popularity, iconic status, and geographic diversity. Include:

   **Existing 10 (keep these, upgrade coordinates):**
   Pacific Crest Trail, Appalachian Trail, John Muir Trail, Continental Divide Trail, Grand Canyon Rim-to-Rim, Wonderland Trail, Teton Crest Trail, The Enchantments, Four Pass Loop, Isle Royale

   **Add 90 more across these categories:**

   Long-distance iconic (10-15): Tahoe Rim Trail, Colorado Trail, Long Trail (VT), Superior Hiking Trail, Arizona Trail, Ozark Highlands Trail, Ice Age Trail, Finger Lakes Trail, Ouachita Trail, Bartram Trail

   National Park classics (20-25): Half Dome (Yosemite), Angels Landing (Zion), Highline Trail (Glacier), Bright Angel Trail (Grand Canyon), Longs Peak (RMNP), Mt Whitney, Clouds Rest (Yosemite), Kalalau Trail (Kauai), Na Pali Coast, Hoh River Trail (Olympic), Skyline Trail (Mt Rainier), Cascade Pass (North Cascades), Cathedral Lakes (Yosemite), Paintbrush Canyon (Tetons), Lake Solitude (Tetons), Grinnell Glacier Trail, Hidden Lake Trail (Glacier), Emerald Lake Trail (RMNP), Sky Pond (RMNP), Navajo Loop (Bryce Canyon)

   Western wilderness (15-20): Wind River High Route, Rae Lakes Loop, Trans-Catalina Trail, Lost Coast Trail, Trinity Alps, Rogue River Trail, Three Sisters Loop, Timberline Trail, Eagle Creek Trail, Sawtooth Traverse, Bob Marshall Traverse, Uinta Highline, Zion Traverse, Capitol Reef, Coyote Gulch

   Appalachian/Eastern (10-15): Franconia Ridge Traverse, Presidential Traverse, Pemi Loop, Great Smoky Mountains (AT section), Knife Edge (Katahdin), Crawford Path, Cranberry Wilderness, Dolly Sods, Linville Gorge, Old Rag, Roan Highlands

   Southwest/Desert (5-10): Havasupai Falls, Superstition Mountains, Grand Gulch, Escalante Route, Buckskin Gulch, The Wave approach

   For each trail, include: name, searchName (OSM name if different), region (state), country ("US"), officialDistanceKm (research from Wikipedia/NPS/USFS), typicalDays, bbox (bounding box covering the trail area -- [minLng, minLat, maxLng, maxLat]).

2. Split the 100-trail JSON into two runs. Run batch-fetch for trails 1-50:
   ```
   npx tsx scripts/trail-curation/batch-fetch.ts scripts/trail-curation/trail-lists/us-trails-batch1.json scripts/trail-curation/results/us-trails-batch1.json
   ```
   (First split us-trails.json into batch1 and batch2 files, or use the first 50 entries)

3. Review the results. For any failed trails:
   - Try alternate search names (e.g., "Half Dome Trail" vs "Half Dome" vs "Yosemite Half Dome")
   - Try broader bounding boxes
   - If still failing, note for manual resolution in the integration plan

4. For flagged trails (distance >2% off):
   - Check if the OSM data is a section rather than the full trail
   - Try alternate OSM relations
   - Record the flag for review but don't block -- we'll fix in the integration plan
  </action>
  <verify>
Check results file: it should contain ~50 trail objects. Count successes vs failures. Calculate: at least 40/50 (80%) should succeed on first pass. Print summary of any failures/flags.
  </verify>
  <done>
US trail list of 100 trails is curated with metadata. First batch of 50 trails fetched from OSM with real coordinates. Success rate documented. Failures logged for retry.
  </done>
</task>

<task type="auto">
  <name>Task 2: Fetch US trails batch 2 (trails 51-100) and resolve failures</name>
  <files>
    scripts/trail-curation/results/us-trails-batch2.json
  </files>
  <action>
1. Run batch-fetch for trails 51-100:
   ```
   npx tsx scripts/trail-curation/batch-fetch.ts scripts/trail-curation/trail-lists/us-trails-batch2.json scripts/trail-curation/results/us-trails-batch2.json
   ```

2. Review results. For failures from both batches, attempt resolution:
   - Try different search terms or OSM relation IDs
   - For short trails or well-known peaks that may not be hiking "routes" in OSM (e.g., summit approaches), try querying for `way[highway=path]["name"~"..."]` instead of route relations
   - For trails that genuinely aren't in OSM, create a manual entry note (these will be manually traced or sourced from government data in the integration plan)

3. Retry failed trails individually using fetch-trail:
   ```
   npx tsx -e "import {fetchTrail} from './scripts/trail-curation/fetch-trail'; fetchTrail({name: 'Trail Name', ...}).then(r => console.log(JSON.stringify(r, null, 2)))"
   ```

4. Target: at least 85 of 100 US trails should have successful OSM data after retries. The remaining 15 can be handled with manual coordinate entry or government data in the integration plan.

5. Merge successful results from both batches and retries into final result files.
  </action>
  <verify>
Count total successful US trails across both batch results. Should be >= 85/100. Print list of any remaining failures with reasons.
  </verify>
  <done>
100 US trails attempted. At least 85 have real OSM coordinate data. Remaining failures documented with reasons and suggested resolution approach.
  </done>
</task>

</tasks>

<verification>
1. `scripts/trail-curation/trail-lists/us-trails.json` contains exactly 100 trail entries
2. Result files contain trail objects with 50-200 coordinate points each
3. At least 85% success rate from OSM queries
4. Failed trails have documented reasons and resolution plans
5. No duplicate trails in the list
</verification>

<success_criteria>
- 100 curated US trail definitions exist in trail-lists/us-trails.json
- At least 85 trails have real coordinate data from OSM
- Each successful trail has 50-200 simplified coordinate points
- Distance validation run on all successful trails
- Failures are documented, not silently dropped
</success_criteria>

<output>
After completion, create `.planning/phases/10-real-trail-data/10-03-SUMMARY.md`
</output>
