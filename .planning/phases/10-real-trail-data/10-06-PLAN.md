---
phase: 10-real-trail-data
plan: 06
type: execute
wave: 3
depends_on: ["10-03", "10-04", "10-05"]
files_modified:
  - app/data/popularTrails.ts
  - scripts/trail-curation/merge-results.ts
  - scripts/trail-curation/generate-trail-data.ts
autonomous: true

must_haves:
  truths:
    - "popularTrails.ts contains 250+ unique deduplicated trail entries"
    - "Every trail has 50-200 coordinate points (not the old 6-18 point simplified data)"
    - "Trails are organized by country with correct country codes"
    - "Any trails that failed OSM fetch have been manually resolved with best-available coordinates"
    - "npm run build passes with the new data file"
  artifacts:
    - path: "app/data/popularTrails.ts"
      provides: "Complete trail data for 250+ trails with real GPX-quality coordinates"
      min_lines: 5000
    - path: "scripts/trail-curation/merge-results.ts"
      provides: "Script to merge all region result files into a single deduplicated set"
    - path: "scripts/trail-curation/generate-trail-data.ts"
      provides: "Script to generate popularTrails.ts from merged results"
  key_links:
    - from: "scripts/trail-curation/generate-trail-data.ts"
      to: "app/data/popularTrails.ts"
      via: "file write"
      pattern: "popularTrails\\.ts"
    - from: "app/data/popularTrails.ts"
      to: "app/components/trails/TrailSelector.tsx"
      via: "import"
      pattern: "import.*popularTrails"
---

<objective>
Merge all regional trail data, resolve any remaining failures with manual coordinates, generate the final popularTrails.ts file, and verify the full build works.

Purpose: This is the integration step that brings together all the data work from Plans 03-05 into the actual application data file. It also handles the "long tail" of trails that couldn't be fetched from OSM.

Output: A complete, production-ready popularTrails.ts with 250+ real-coordinate trails.
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md

# All prior plan summaries needed for this integration
@.planning/phases/10-real-trail-data/10-01-SUMMARY.md
@.planning/phases/10-real-trail-data/10-03-SUMMARY.md
@.planning/phases/10-real-trail-data/10-04-SUMMARY.md
@.planning/phases/10-real-trail-data/10-05-SUMMARY.md

# Current trail data structure
@app/data/popularTrails.ts (first 15 lines -- TrailData interface)
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create merge and code generation scripts</name>
  <files>
    scripts/trail-curation/merge-results.ts
    scripts/trail-curation/generate-trail-data.ts
  </files>
  <action>
1. Create `scripts/trail-curation/merge-results.ts`:
   - Reads all result JSON files from `scripts/trail-curation/results/` directory
   - Merges all successful trail objects into one array
   - Runs deduplication (from deduplicate-trails.ts) on the full set
   - Sorts by country code, then alphabetically by name within country
   - Outputs a single `scripts/trail-curation/results/all-trails-merged.json`
   - Prints summary: total trails per country, any duplicates removed, total coordinate points

2. Create `scripts/trail-curation/generate-trail-data.ts`:
   - Reads `all-trails-merged.json`
   - Generates the TypeScript source code for `app/data/popularTrails.ts`
   - Preserves the existing TrailData interface at the top of the file
   - Groups trails by country with comment separators (matching existing style: `// ============ COUNTRY ============`)
   - Formats coordinate arrays with 3 coordinates per line (matching existing style)
   - Rounds coordinates: lng/lat to 3 decimal places, elevation to nearest integer
   - Writes the output file directly
   - Usage: `npx tsx scripts/trail-curation/generate-trail-data.ts`

3. Important formatting rules for generate-trail-data.ts:
   - Trail ID format: lowercase, underscores, no special chars (e.g., "pacific_crest_trail")
   - Country code format: 2-letter ISO (US, CA, AU, JP, NZ, GB, FR, CH, IT, ZA, DE)
   - Coordinate format: `[lng, lat, elevation]` with 3 decimal places for lng/lat
   - Each trail object should be formatted consistently with the existing style
  </action>
  <verify>
Run `npx tsx scripts/trail-curation/merge-results.ts` and check the merged output file exists with the expected trail count. Then run `npx tsx scripts/trail-curation/generate-trail-data.ts` and verify it creates a new popularTrails.ts.
  </verify>
  <done>
Merge and generation scripts exist and work. Can produce a complete popularTrails.ts from the result JSON files.
  </done>
</task>

<task type="auto">
  <name>Task 2: Resolve failed trails, generate final data file, and verify build</name>
  <files>
    app/data/popularTrails.ts
  </files>
  <action>
1. Run the merge script to see the current state:
   ```
   npx tsx scripts/trail-curation/merge-results.ts
   ```
   Review the output: how many trails total? Which countries have gaps?

2. For trails that failed OSM fetching (documented in Plan 03/04/05 summaries):
   - Check if the trail existed in the OLD popularTrails.ts data. If so, we can keep the old simplified coordinates as a fallback (better than nothing -- they show approximate route shape).
   - For trails NOT in the old data that failed OSM: create manual entries with best-effort coordinates. Use the trail's known start/end points plus intermediate waypoints from Wikipedia/park websites. Aim for at least 10-20 points for manual entries (less than the 50-200 target but acceptable for rare cases).
   - Add manual entries to a `scripts/trail-curation/results/manual-trails.json` file

3. Re-run merge with manual trails included, then generate:
   ```
   npx tsx scripts/trail-curation/merge-results.ts
   npx tsx scripts/trail-curation/generate-trail-data.ts
   ```

4. Verify the generated file:
   - Count total trails: should be 250+
   - Count per country: US=100, CA=25, AU=50, others=~10 each (77 from existing + 23 new)
   - No trail ID duplicates: `grep "id:" app/data/popularTrails.ts | sort | uniq -d` should be empty
   - Every trail has coordinates array with at least 6 points

5. Run build verification:
   ```
   npm run build
   ```
   This will catch any TypeScript errors in the generated file.

6. Run the dev server and verify the TrailSelector loads without errors and shows all trails grouped by country.

7. Spot-check 5-10 trails: verify coordinates look reasonable (e.g., Pacific Crest Trail starts in Southern CA and ends in WA, Tour du Mont Blanc goes around Mont Blanc). Quick sanity check, not exhaustive.
  </action>
  <verify>
`npm run build` passes. Trail count in popularTrails.ts is 250+. No duplicate IDs. TrailSelector renders correctly in dev mode. Per-country counts match targets.
  </verify>
  <done>
popularTrails.ts contains 250+ unique trails with real coordinate data. All failed OSM fetches resolved with fallback data. Build passes. TrailSelector displays all trails grouped by country.
  </done>
</task>

</tasks>

<verification>
1. `npm run build` passes with no errors
2. `grep -c "id:" app/data/popularTrails.ts` returns 250+
3. `grep "id:" app/data/popularTrails.ts | sort | uniq -d` returns empty (no duplicates)
4. Every weather API country has trail entries
5. TrailSelector renders with country grouping in dev mode
6. US has ~100 trails, CA has ~25, AU has ~50 (including 25+ TAS)
</verification>

<success_criteria>
- popularTrails.ts contains 250+ unique deduplicated trails
- All trails have real coordinate data (50-200 points for OSM-sourced, 10+ for manual fallbacks)
- Build passes cleanly
- TrailSelector displays all trails grouped by country with "Coming Soon" absent (all countries have data)
- No trail appears twice
</success_criteria>

<output>
After completion, create `.planning/phases/10-real-trail-data/10-06-SUMMARY.md`
</output>
