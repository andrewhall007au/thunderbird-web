---
phase: 10-real-trail-data
plan: 06
type: execute
wave: 3
depends_on: ["10-03", "10-04", "10-04b", "10-05"]
files_modified:
  - app/data/popularTrails.ts
  - scripts/trail-curation/merge-results.ts
  - scripts/trail-curation/generate-trail-data.ts
autonomous: true

must_haves:
  truths:
    - "popularTrails.ts contains 350+ unique deduplicated trail entries"
    - "Every trail has 50-200 coordinate points (not the old 6-18 point simplified data)"
    - "Every trail includes trailLow and trailHigh elevation waypoints"
    - "Trails are organized by country with correct country codes"
    - "Any trails that failed OSM fetch have been manually resolved with best-available coordinates"
    - "npm run build passes with the new data file"
  artifacts:
    - path: "app/data/popularTrails.ts"
      provides: "Complete trail data for 350+ trails with real GPX-quality coordinates and elevation waypoints"
      min_lines: 5000
    - path: "scripts/trail-curation/merge-results.ts"
      provides: "Script to merge all region result files into a single deduplicated set"
    - path: "scripts/trail-curation/generate-trail-data.ts"
      provides: "Script to generate popularTrails.ts from merged results, including trailLow/trailHigh waypoints"
  key_links:
    - from: "scripts/trail-curation/generate-trail-data.ts"
      to: "app/data/popularTrails.ts"
      via: "file write"
      pattern: "popularTrails\\.ts"
    - from: "app/data/popularTrails.ts"
      to: "app/components/trails/TrailSelector.tsx"
      via: "import"
      pattern: "import.*popularTrails"
---

<objective>
Merge all regional trail data (US, Canada, Australia, New Zealand, Global), resolve any remaining failures with manual coordinates, generate the final popularTrails.ts file with trailLow/trailHigh elevation waypoints, and verify the full build works.

Purpose: This is the integration step that brings together all the data work from Plans 03, 04, 04b, and 05 into the actual application data file. It also handles the "long tail" of trails that couldn't be fetched from OSM, and ensures every trail has elevation waypoints marking its lowest and highest points.

Output: A complete, production-ready popularTrails.ts with 350+ real-coordinate trails, each with trailLow and trailHigh waypoints.
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md

# All prior plan summaries needed for this integration
@.planning/phases/10-real-trail-data/10-01-SUMMARY.md
@.planning/phases/10-real-trail-data/10-03-SUMMARY.md
@.planning/phases/10-real-trail-data/10-04-SUMMARY.md
@.planning/phases/10-real-trail-data/10-04b-SUMMARY.md
@.planning/phases/10-real-trail-data/10-05-SUMMARY.md

# Current trail data structure
@app/data/popularTrails.ts (first 15 lines -- TrailData interface)
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create merge and code generation scripts with elevation waypoint support</name>
  <files>
    scripts/trail-curation/merge-results.ts
    scripts/trail-curation/generate-trail-data.ts
  </files>
  <action>
1. Create `scripts/trail-curation/merge-results.ts`:
   - Reads all result JSON files from `scripts/trail-curation/results/` directory (us-trails, canada-trails, australia-trails, nz-trails, global-trails batches)
   - Merges all successful trail objects into one array
   - Runs deduplication (from deduplicate-trails.ts) on the full set
   - For each trail, ensures elevationWaypoints (trailLow/trailHigh) are present. If a trail result is missing elevation waypoints (e.g., from a manual entry), run `findElevationWaypoints` from elevation-waypoints.ts on its coordinates to generate them.
   - Sorts by country code, then alphabetically by name within country
   - Outputs a single `scripts/trail-curation/results/all-trails-merged.json`
   - Prints summary: total trails per country, any duplicates removed, total coordinate points, trails with valid elevation data vs zero-elevation

2. Create `scripts/trail-curation/generate-trail-data.ts`:
   - Reads `all-trails-merged.json`
   - Updates the TrailData interface to include elevation waypoints:
     ```typescript
     export interface ElevationWaypoint {
       name: string;
       coordinates: [number, number, number]; // [lng, lat, elevation]
     }

     export interface TrailData {
       id: string;
       name: string;
       region: string;
       country: string;
       distance_km: number;
       typical_days: string;
       coordinates: [number, number, number][]; // [lng, lat, elevation]
       trailLow: ElevationWaypoint;
       trailHigh: ElevationWaypoint;
     }
     ```
   - Generates the TypeScript source code for `app/data/popularTrails.ts`
   - For each trail, includes `trailLow` and `trailHigh` fields populated from the elevationWaypoints data in the merged JSON
   - Groups trails by country with comment separators (matching existing style: `// ============ COUNTRY ============`)
   - Formats coordinate arrays with 3 coordinates per line (matching existing style)
   - Rounds coordinates: lng/lat to 3 decimal places, elevation to nearest integer
   - Writes the output file directly
   - Usage: `npx tsx scripts/trail-curation/generate-trail-data.ts`

3. Important formatting rules for generate-trail-data.ts:
   - Trail ID format: lowercase, underscores, no special chars (e.g., "pacific_crest_trail")
   - Country code format: 2-letter ISO (US, CA, AU, NZ, JP, GB, FR, CH, IT, ZA, DE)
   - Coordinate format: `[lng, lat, elevation]` with 3 decimal places for lng/lat
   - trailLow/trailHigh format: `{ name: "Trail Low Point", coordinates: [lng, lat, elevation] }`
   - Each trail object should be formatted consistently with the existing style
  </action>
  <verify>
Run `npx tsx scripts/trail-curation/merge-results.ts` and check the merged output file exists with the expected trail count. Then run `npx tsx scripts/trail-curation/generate-trail-data.ts` and verify it creates a new popularTrails.ts with trailLow/trailHigh on every trail entry.
  </verify>
  <done>
Merge and generation scripts exist and work. Can produce a complete popularTrails.ts from the result JSON files with elevation waypoints on every trail.
  </done>
</task>

<task type="auto">
  <name>Task 2: Resolve failed trails, generate final data file, and verify build</name>
  <files>
    app/data/popularTrails.ts
  </files>
  <action>
1. Run the merge script to see the current state:
   ```
   npx tsx scripts/trail-curation/merge-results.ts
   ```
   Review the output: how many trails total? Which countries have gaps?

2. For trails that failed OSM fetching (documented in Plan 03/04/04b/05 summaries):
   - Check if the trail existed in the OLD popularTrails.ts data. If so, we can keep the old simplified coordinates as a fallback (better than nothing -- they show approximate route shape).
   - For trails NOT in the old data that failed OSM: create manual entries with best-effort coordinates. Use the trail's known start/end points plus intermediate waypoints from Wikipedia/park websites. Aim for at least 10-20 points for manual entries (less than the 50-200 target but acceptable for rare cases).
   - For manual entries, also run findElevationWaypoints to generate trailLow/trailHigh from the available coordinates.
   - Add manual entries to a `scripts/trail-curation/results/manual-trails.json` file

3. Re-run merge with manual trails included, then generate:
   ```
   npx tsx scripts/trail-curation/merge-results.ts
   npx tsx scripts/trail-curation/generate-trail-data.ts
   ```

4. Verify the generated file:
   - Count total trails: should be 350+
   - Count per country: US=100, CA=50, AU=50, NZ=50, others=~14 each (100 global across 7 countries)
   - No trail ID duplicates: `grep "id:" app/data/popularTrails.ts | sort | uniq -d` should be empty
   - Every trail has coordinates array with at least 6 points
   - Every trail has trailLow and trailHigh fields
   - Spot-check that trailLow.coordinates[2] < trailHigh.coordinates[2] for trails with real elevation data

5. Run build verification:
   ```
   npm run build
   ```
   This will catch any TypeScript errors in the generated file (including the new TrailData interface with trailLow/trailHigh).

6. Run the dev server and verify the TrailSelector loads without errors and shows all trails grouped by country.

7. Spot-check 5-10 trails: verify coordinates look reasonable AND trailLow/trailHigh are sensible (e.g., for Grand Canyon Rim-to-Rim, trailLow should be near the river at ~730m, trailHigh should be near the rim at ~2400m).
  </action>
  <verify>
`npm run build` passes. Trail count in popularTrails.ts is 350+. No duplicate IDs. Every trail has trailLow and trailHigh. TrailSelector renders correctly in dev mode. Per-country counts match targets.
  </verify>
  <done>
popularTrails.ts contains 350+ unique trails with real coordinate data and elevation waypoints (trailLow/trailHigh). All failed OSM fetches resolved with fallback data. Build passes. TrailSelector displays all trails grouped by country.
  </done>
</task>

</tasks>

<verification>
1. `npm run build` passes with no errors
2. `grep -c "id:" app/data/popularTrails.ts` returns 350+
3. `grep "id:" app/data/popularTrails.ts | sort | uniq -d` returns empty (no duplicates)
4. Every trail entry has trailLow and trailHigh fields
5. Every weather API country has trail entries (including NZ)
6. TrailSelector renders with country grouping in dev mode
7. US has ~100 trails, CA has ~50, AU has ~50, NZ has ~50
</verification>

<success_criteria>
- popularTrails.ts contains 350+ unique deduplicated trails
- All trails have real coordinate data (50-200 points for OSM-sourced, 10+ for manual fallbacks)
- All trails have trailLow and trailHigh elevation waypoints
- TrailData interface updated with trailLow/trailHigh fields
- Build passes cleanly
- TrailSelector displays all trails grouped by country with "Coming Soon" absent (all countries have data)
- No trail appears twice
</success_criteria>

<output>
After completion, create `.planning/phases/10-real-trail-data/10-06-SUMMARY.md`
</output>
